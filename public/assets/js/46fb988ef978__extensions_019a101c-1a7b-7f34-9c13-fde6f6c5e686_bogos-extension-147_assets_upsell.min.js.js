(()=>{(function(){if(window.fgData?.appearance?.fbt_upsell?.content?.shopify_shipping_icon_path&&typeof fgShippingIconsObj<"u"){let e=window.fgData.appearance?.fbt_upsell?.content?.shopify_shipping_icon_path;window.fgData.appearance.fbt_upsell.content.shipping_icon_path=fgShippingIconsObj[e]??e}let{proxy:St,integration:G,shopifyFunc:pt,storefront:_t,collect:ft,utils:ht}=window.FGSECOMAPP.helper||{},ct=FGSECOMAPP.variables.RATE_PRICE??100;FGSECOMAPP.CUSTOM_EVENTS={...FGSECOMAPP.CUSTOM_EVENTS,BOGOS_UPSELL_INIT:"bogos:upsell-init",BOGOS_UPSELL_START:"bogos:upsell-start",BOGOS_UPSELL_ADDED:"bogos:upsell-added",BOGOS_FBT_RENDER:"bogos:fbt-render"};class Tt{static GET_PRODUCTS_RECOMMENDED=`
        query productRecommendations(
            $id: ID!, 
            $intent: ProductRecommendationIntent,
            $numberCollections: Int, 
            $numberVariants: Int,
            $country: CountryCode, 
            $language: LanguageCode
        ) @inContext(country: $country, language: $language) {
            productRecommendations(productId: $id, intent: $intent) {
                id
                title
                vendor
                productType
                handle
                tags
                availableForSale
                featuredImage {
                   url
                }
                collections (first: $numberCollections) {
                    nodes {
                        id
                        title
                    }
                }
                variants(first: $numberVariants) {
                    nodes {
                        id
                        title
                        price {
                            amount
                        }
                        compareAtPrice {
                            amount
                        }
                        availableForSale
                    }
                }
            }
        }`}let u={NARROW_TYPE:{product:"variants_ids",product_types:"product_types",product_vendors:"product_vendors",collection:"product_collections"},DISCOUNT_TYPE:{percentage:"percentage",fixed_amount:"fixed_amount",fixed_price:"fixed_price",free_products:"free_products",cheapest_free:"cheapest_free"},UPSELL_TYPE:{default:"upsell",fbt:"fbt",checkout:"checkout"},UPSELL_METHOD:{manual:"manual",auto:"auto",random:"random"},FBT_WIDGET_TYPE:{classic:"classic",stack:"stack"},APPLY_DISCOUNT_OPTION:{any:"any",exclude_cur_item:"exclude_cur"}};u.TRIGGER_FUNC={[u.UPSELL_TYPE.fbt]:"FBT"};let O={FBT_CONTAINER_SECTION_ID:"#bogos-fbt-upsell-container",FBT_CONTAINER_SECTION:`<div class="bogos-fbt-upsell-container" data-upsell-id="{{ bogos_upsell_id }}">
              {{ bogos_fbt_upsell_header }}
              {{ bogos_fbt_upsell_body }}
              {{ bogos_fbt_upsell_stack_see_more }}
              {{ bogos_fbt_upsell_stack_shipping_discount }}
              {{ bogos_fbt_upsell_footer_stack }}
              {{ bogos_fbt_upsell_classic_see_more }}
            </div >`,FBT_HEADER_SECTION_ID:"#bogos-fbt-upsell-header",FBT_HEADER_SECTION:`
            <div class="bogos-fbt-upsell-header">
                <div class="bogos-fbt-header-title">{{ bogos_fbt_header_title }}</div>
                <div class="bogos-fbt-header-description">{{ bogos_fbt_header_description }}</div>
            </div>`,FBT_BODY_SECTION_ID:"#bogos-fbt-upsell-body",FBT_BODY_SECTION:`
            <div class="bogos-fbt-upsell-body" style="{{bogos_fbt_overflow}}">
                <div class="bogos-fbt-upsell-extra">
                    {{ bogos_fbt_upsell_body_item }}
                    {{ bogos_fbt_upsell_shipping_discount_classic}}
                    {{ bogos_fbt_upsell_footer_classic }}
                </div>
                {{ bogos_fbt_upsell_body_classic_info }}
            </div>`,FBT_BODY_ITEM_STACK_ID:"#bogos-fbt-upsell-body-stack-item",FBT_BODY_ITEM_STACK_SECTION:`<div class="bogos-fbt-upsell-body-stack-item {{bogos_fbt_cheapest_free}}" 
                data-variant-id="{{ bogos_variant_id }}" 
                data-variant-price="{{bogos_variant_price}}" 
                data-product-id="{{bogos_product_id}}" 
                data-quantity-variant="{{bogos_variant_quantity}}"
            >
                {{ bogos_fbt_cheapest_free_label }}
                <div class="bogos-fbt-stack-item-wrapper">
                    <div class="bogos-fbt-upsell-body-stack-item-container">
                        <div class="bogos-fbt-upsell-body-stack-meta">
                            <input id="bogos-fbt-item-checkbox" type="checkbox" class="bogos-fbt-upsell-body-item-checkbox" checked/>    
                            <a class="bogos-fbt-upsell-img-wrapper" href="{{bogos_fbt_upsell_pro_link}}">
                                <img loading="lazy" class="bogos-fbt-upsell-img" src="{{ bogos_fbt_upsell_img }}" alt="{{ bogos_fbt_upsell_title }}">
                            </a>
                        </div>
                        <div class="bogos-fbt-upsell-product-info">
                            <div class="bogos-fbt-upsell-product-title">
                                <div class="bogos-fbt-fixed-quantity">{{bogos_fixed_quantity}}</div>
                                <div class="bogos-fbt-this-item">{{ bogos_this_item }}</div>
                                <a class="bogos-fbt-product-title" href="{{ bogos_fbt_upsell_pro_link }}">{{ bogos_fbt_product_title }}</a>
                            </div>
                            <div class="bogos-fbt-upsell-product">
                                <div class="bogos-fbt-upsell-product-price">
                                    <div class="bogos-fbt-upsell-product-discounted-price">{{bogos_fbt_product_discounted_price}}</div>
                                    <div class="bogos-fbt-upsell-product-original-price">{{bogos_fbt_product_original_price}}</div>
                                </div>
                                <div class="bogos-fbt-upsell-product-variants {{ bogos_none }}">
                                     <div class="bogos-fbt-upsell-select-variant-dropdown">
                                        <div class="bogos-fbt-upsell-select-variant-title-contain">
                                            <span class="bogos-fbt-upsell-select-variant-title">{{ bogos_default_select_variant_title }}</span>
                                        </div>
                                        <ul class="bogos-fbt-product-item-select-variant" data-product-id="{{bogos_product_id}}">
                                            {{ bogos_fbt_product_item_select_variant }}
                                        </ul>
                                     </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {{ bogos_fbt_product_quantity }}
                </div>
                {{ bogos_fbt_cheapest_free_description }}
            </div>`,FBT_BODY_ITEM_CLASSIC_IMG_ID:"#bogos-fbt-upsell-body-classic-item-wrapper",FBT_BODY_ITEM_CLASSIC_IMG_SECTION:`<div class="bogos-fbt-upsell-body-classic-item-img-wrapper">
                 {{ bogos_items }}
            </div>`,FBT_BODY_ITEM_CLASSIC_IMG_ITEM:`
            <a class="bogos-fbt-upsell-body-classic-item-img" data-product-id="{{ bogos_product_id }}" data-variant-id="{{ bogos_variant_id }}"  href="{{ bogos_fbt_upsell_pro_link }}">
                <img loading="lazy" class="bogos-fbt-upsell-img" src="{{ bogos_fbt_upsell_img }}" alt="{{ bogos_fbt_upsell_title }}">
            </a>`,FBT_BODY_ITEM_CLASSIC_INFO_ID:"#bogos-fbt-upsell-body-classic-item-info-wrapper",FBT_BODY_ITEM_CLASSIC_INFO_SECTION:`<div class="bogos-fbt-upsell-body-classic-item-info-wrapper">
               {{bogos_items}}
            </div>`,FBT_BODY_ITEM_CLASSIC_INFO_ITEM:`<div class="bogos-fbt-upsell-body-classic-item-info {{bogos_fbt_cheapest_free}}" 
                data-product-id="{{bogos_product_id}}" 
                data-variant-id="{{ bogos_variant_id }}" 
                data-quantity-variant="{{bogos_variant_quantity}}"
                data-variant-price="{{bogos_variant_price}}" 
            >
                {{ bogos_fbt_cheapest_free_label }}
                <div class="bogos-fbt-classic-item-wrapper">
                    <div class="bogos-fbt-upsell-body-classic-item-info-container">
                        <input id="bogos-fbt-upsell-item-checkbox" type="checkbox" class="bogos-fbt-upsell-body-item-checkbox" checked/>   
                        <div class="bogos-fbt-classic-meta">
                            <div class="bogos-fbt-upsell-classic-info">
                                <div class="bogos-fbt-product-info-classic">
                                   <div class="bogos-fbt-upsell-product-title">
                                        <div class="bogos-fbt-fixed-quantity">{{bogos_fixed_quantity}}</div> 
                                        <div class="bogos-fbt-this-item">{{ bogos_this_item }}</div>
                                        <a class="bogos-fbt-product-title" href="{{ bogos_fbt_upsell_pro_link }}">{{ bogos_fbt_product_title }}</a>
                                   </div> 
                                </div>
                            </div>
                            <div class="bogos-fbt-upsell-classic-product-info">
                                <div class="bogos-fbt-upsell-product-variants {{ bogos_none }}">
                                    <div class="bogos-fbt-upsell-select-variant-dropdown">
                                        <div class="bogos-fbt-upsell-select-variant-title-contain">
                                            <span class="bogos-fbt-upsell-select-variant-title">{{ bogos_default_select_variant_title }}</span>
                                        </div>
                                        <ul class="bogos-fbt-product-item-select-variant" data-product-id="{{bogos_product_id}}">
                                            {{ bogos_fbt_product_item_select_variant }}
                                        </ul>
                                     </div>
                                 </div>
                                 <div class="bogos-fbt-upsell-product-price">
                                     <div class="bogos-fbt-upsell-product-discounted-price">{{bogos_fbt_product_discounted_price}}</div>
                                     <div class="bogos-fbt-upsell-product-original-price">{{bogos_fbt_product_original_price}}</div>
                                 </div>
                            </div>
                        </div>
                    </div>
                    {{ bogos_fbt_product_quantity }}
                </div>
                {{ bogos_fbt_cheapest_free_description }}
            </div>`,FBT_BODY_SECTION_SELECT_VARIANT_ID:"#bogos-fbt-body-select-variant-section",FBT_BODY_SECTION_SELECT_VARIANT:`<li class="bogos-fbt-variant-item" data-img="{{ bogos_variant_img }}" value="{{ bogos_variant_id }}" id="{{ bogos_variant_id }}" data-product-id="{{bogos_product_id}}" data-price="{{ bogos_variant_price }}" data-original-price="{{ bogos_original_variant_price }}">
                {{ fg_variant_title }}
            </li>`,FBT_FOOTER_SECTION_ID:"#bogos-fbt-upsell-footer",FBT_FOOTER_SECTION:`<div class="bogos-fbt-upsell-footer">
                <div class="bogos-fbt-footer-price">
                    <div class="bogos-fbt-footer-price-title">{{ bogos_fbt_price_title }}</div>
                    <div class="bogos-fbt-footer-price">
                        <div class="bogos-fbt-footer-discounted-price transcy-money">{{ bogos_fbt_footer_discounted_price}}</div>
                        <div class="bogos-fbt-footer-original-price transcy-money">{{ bogos_fbt_footer_original_price}}</div>
                    </div>
                </div>
                 <button type="button" class="bogos-fbt-footer-button-add">{{ bogos_fbt_footer_add_button }}</button>
            </div>`,FBT_SEE_MORE:'<button type="button" class="bogos-fbt-see-more">{{ bogos_fbt_see_more }}</button>',FBT_PRODUCT_QUANTITY:`<div class="bogos-fbt-upsell-product-quantity-container">
                <div class="bogos-fbt-upsell-product-quantity">
                    <button type="button" class="bogos-minus-fbt-btn" {{ bogos_disable }}>\u2212</button>
                    <input type="number" class="bogos-fbt-upsell-quantity-input input-box"
                           value="{{ bogos_fbt_min_quantity }}" min="1">
                    <button type="button" class="bogos-plus-fbt-btn">+</button>
                </div>
            </div>`,FBT_CHEAPEST_FREE_LABEL:`<div class="is-cheapest-free-label {{bogos_d_none}}">
                {{ bogos_cheapest_free_label }}
            </div>`,FBT_CHEAPEST_FREE_DES:`<div class="is-cheapest-free-des-container" style="{{bogos_d_none}}">
                {{bogos_cheapest_items}}
            </div>`,FBT_CHEAPEST_FREE_DES_ITEM:`<div class="is-cheapest-free-des-original">
                <div class="is-cheapest-free-des-count">{{bogos_cheapest_des_count}}</div>
                <div class="is-cheapest-free-des-price">{{bogos_cheapest_des_price}}</div>
            </div>`,FBT_SHIPPING_DISCOUNT_SECTION_ID:"#sca_fbt_shipping_discount_section",FBT_SHIPPING_DISCOUNT_SECTION:`<div class="bogos-fbt-shipping-discount-container">
                <div class="bogos-shipping-discount-icon">
                    <img src="{{ bogos_shipping_icon }}" alt="shipping-icon">
                </div>
                <span class="bogos-fbt-shipping-discount-title">
                    {{ bogos_shipping_discount_title }}
                </span>
            </div>`},it={renderEmpty:e=>{e.style.display="",e.innerHTML="No upsell offers are available for what you\u2019re viewing."},add:async(e,o,n,t=u.UPSELL_TYPE.fbt,c=!0)=>{try{let{default:m}=u.UPSELL_TYPE,s=Math.random().toString(36).substring(8),a=`${u.TRIGGER_FUNC[t]}_${n}_${o}_${s}`,i=await pt.add_items_trigger(e,{_bogos_trigger_id:n,_bogos_trigger:a,_bogos_trigger_type:t},t),l="";if(i.ok){let E=FGSECOMAPP.upsells?.find(S=>S.id?.toString()===n?.toString())?.code;c&&await pt.apply_discounts([E]),ft.addToCart([{id:n}],t,m).then(),document.dispatchEvent(new CustomEvent(FGSECOMAPP.CUSTOM_EVENTS.BOGOS_UPSELL_ADDED,{detail:{items:e,code:E}})),await G.renderCart({item_count:1}),document.dispatchEvent(new CustomEvent(FGSECOMAPP.CUSTOM_EVENTS.BOGOS_FG_PROCESS,{detail:{event:"upsell:added"}}))}else l=(await i.json()).message;return{ok:i.ok,message:l}}catch(m){return console.error("BOGOS track: upsell added failed",m),{ok:!1,message:"Something went wrong!"}}},init:async e=>{try{document.dispatchEvent(new CustomEvent(FGSECOMAPP.CUSTOM_EVENTS.BOGOS_UPSELL_START));let o=JSON.parse(JSON.stringify(window.fgData?.upsells??[]));FGSECOMAPP.upsells=o?.filter(({start_time:n,end_time:t,type:c})=>c!==u.UPSELL_TYPE.checkout&&_.checkValidTimeOffer(n,t)).sort((n,t)=>new Date(n.start_time)-new Date(t.start_time)),_.empty(FGSECOMAPP.upsells)||(history.scrollRestoration="manual"),await Promise.all([d.init(e)])}catch(o){console.warn("BOGOS track: upsell core init failed",o)}}},d={currentVariantsValid:{},productsToShow:{},productsHidden:{},productsHandleToSync:[],filterWithBlocks:e=>{let o=(i,l)=>{let f=l?.variants?.map(S=>({variant_id:S.id,product_id:l.id,product_title:l.title,price:S.price,variant_title:S.title,handle:l.handle,vendor:l.vendor,product_type:l.type,collections:l.collections})),E=(i.trigger?.[0]?.option??i.trigger?.option)==="any";return _.findProductsMatchConditions(f,{product_narrow:E?[]:i.trigger})?.length>0},n={},t=e?FGSECOMAPP.current_upsells_fbt:FGSECOMAPP.upsells?.filter(i=>i.type===u.UPSELL_TYPE.fbt),{current_product:c}=FGSECOMAPP.variables.Shopify??{},m=_.empty(c?.id)?[]:t?.filter(i=>o(i,c)),{product_form_query:s}=FGSECOMAPP.QUERY_SELECTOR??{},a=e?[e]:document.querySelectorAll(s?.fbt_upsell?.join(","));return a.forEach(i=>{let l=Number(_.getIntShopifyId(i.getAttribute("data-product-id"))),f=Number(i.getAttribute("data-offer-id")),E=null;f&&(E=(E??t)?.filter(S=>S.id.toString()===f.toString())),l&&(E=(E??t)?.filter(S=>o(S,window.BOGOS?.block_products?.[l]??FGSECOMAPP.productsByID?.[l]??{}))),E?.forEach(S=>n[S.id]={...S,current_product:e?l:void 0}),!f&&!l&&m.forEach(S=>n[S.id]=S)}),a.length||m.forEach(i=>n[i.id]=i),Object.values(n)},convertData:async(e,o)=>{o??=FGSECOMAPP.variables.Shopify.current_product??{};let n=JSON.parse(JSON.stringify(e??FGSECOMAPP.current_upsells_fbt)).filter(t=>{let c=(o?.variants??[]).filter(i=>i.available);if(!(t.trigger?.[0]?.type===u.NARROW_TYPE.product))return!0;let s=t.trigger[0]?.filter_option,a=Object.values(t.trigger[0]?.value).map(i=>i.variants??i.variant).flat().map(i=>i.id);return c=c.filter(i=>s==="include"?a.includes(i.id):!a.includes(i.id)),d.currentVariantsValid[t.id]={...d.currentVariantsValid[t.id]??{}},d.currentVariantsValid[t.id][o.id]=c,c.length>0});for(let t of n){d.productsToShow[t.id]={...d.productsToShow[t.id]??{}};let c=t.products.method,m=JSON.parse(JSON.stringify(o)),s=d.currentVariantsValid[t.id]?.[m.id]??null;s&&(m.variants=s);let a=_.convertProductShopifyData(m);if(c===u.UPSELL_METHOD.manual)d.productsToShow[t.id]={...d.productsToShow?.[t.id]??{}},d.productsToShow[t.id][m.id]=_.getUniqueElementByKey([a,...t.products.products],"id").sort((i,l)=>i.id===a.id?-1:0);else{let i=c===u.UPSELL_METHOD.auto,l=i?t.products.auto:t.products.random;await d.getProductsToShow(a,l,t.id,i)}}return n},getProductsToSync:e=>{let o=[],n=[];for(let t of e)if(t.products.method===u.UPSELL_METHOD.manual){let m=t.products.products.map(({handle:s})=>s);o.push(...m),n.push(...t.products.products.map(({id:s})=>s))}return{handles:o,ids:n}},filter:async e=>{try{await G?.searchProductsBlock?.("fbt_upsell"),FGSECOMAPP.current_upsells_fbt=d.filterWithBlocks();let o=d.getProductsToSync(FGSECOMAPP.current_upsells_fbt);!e&&await St.cacheProducts(o?.handles,{"sca-upsell-search":"1"},async()=>{console.info(`BOGOS track: upsell-fbt:sync-quantity:${Date.now()}`)},o)}catch(o){console.warn("BOGOS track: upsell fbt filter failed",o)}},processGetProductsRandom:async(e,o,n,t="")=>{let c=[],m=!0;for(;m&&!_.empty(t);){let s=JSON.parse(localStorage.getItem(`${n}_${e}`)??"{}");new Date().getTime()-(s?.date??0)>18e5&&(s.value=void 0);let a=n==="sca_cursor_collection"?await ut.queryProductsInCollection(e,o,s?.value):await ut.queryProducts(t,o,s?.value),{hasNextPage:i,endCursor:l}=a.meta_data;if(a.data.length>=o-6){i&&localStorage.setItem(`${n}_${e}`,JSON.stringify({value:l,date:new Date().getTime()})),c.push(...a.data);break}else i||(c.push(...a.data),m=!1);localStorage.removeItem(`${n}_${e}`)}return c},getProductsToShow:async(e,o,n,t)=>{let c=o.number_of_products,m=e.id;if(t){let s=await ut.queryProductsRecommended({productId:`gid://shopify/Product/${m}`,intent:o.intent},c);d.productsToShow[n]={...d.productsToShow[n]??{}},d.productsToShow[n][m]=_.getUniqueElementByKey([e,...s],"id")}else{let s=o?.products.find(b=>b.type===u.NARROW_TYPE.collection),a=o?.products.find(b=>b.type===u.NARROW_TYPE.product_types),i=o?.products.find(b=>b.type===u.NARROW_TYPE.product_vendors),l=[],f=[],E=c+6;if(!_.empty(s)){let b=_.sufferArray(Array.isArray(s.value)?Object.values(s.value):Object.keys(s.value)),T=[];for(let R=0;R<b.length&&!(T.length>c);R++){let L=await d.processGetProductsRandom(b[R],E,"sca_cursor_collection","1");T.push(...L)}l=_.getUniqueElementByKey(T,"id")}let S="";_.empty(a)||(S=`(${Object.keys(a.value).map(T=>`(product_type:${T})`).join(" OR ")})`);let q="";_.empty(i)||(q=`${Object.keys(i.value).map(T=>`(vendor:${T})`).join(" OR ")}`);let y=_.empty(S)&&_.empty(q),h=[S,q].filter(Boolean).join(" OR "),I=y?"":h,F=await d.processGetProductsRandom("",E,"sca_cursor_product",I);f.push(...F);let M=_.getUniqueElementByKey([e,...l,...f],"id"),v=_.sufferArray(M).sort((b,T)=>b.id===e.id?-1:T.id===e.id?1:0);d.productsToShow[n]={...d.productsToShow[n]??{}},d.productsToShow[n][m]=v.slice(0,c+1)}},renderUpsells:(e,o)=>{let{current_product:n}=FGSECOMAPP.variables.Shopify??{};o??=n??{};let t=document.querySelector(O.FBT_CONTAINER_SECTION_ID)?.innerHTML??O.FBT_CONTAINER_SECTION,c=document.querySelector(O.FBT_HEADER_SECTION_ID)?.innerHTML??O.FBT_HEADER_SECTION,m=document.querySelector(O.FBT_BODY_SECTION_ID)?.innerHTML??O.FBT_BODY_SECTION,s=document.querySelector(O.FBT_FOOTER_SECTION_ID)?.innerHTML??O.FBT_FOOTER_SECTION,a=O.FBT_SEE_MORE,i=document.querySelector(O.FBT_SHIPPING_DISCOUNT_SECTION_ID)?.innerHTML??O.FBT_SHIPPING_DISCOUNT_SECTION,l=FGSECOMAPP.productsByID,f=FGSECOMAPP.fgAppearance?.fbt_upsell??{},{widget_layout:E,show_discount_amount:S,maximum_display:q}=f?.general??{},{button_text:y,total_price_text:h,shipping_icon_path:I}=f?.content??{},F=q??3,M=o;return(e??FGSECOMAPP.current_upsells_fbt)?.map(v=>{let b=v.id,T=(E??u.FBT_WIDGET_TYPE.classic)===u.FBT_WIDGET_TYPE.classic,R=v.products.method,L=(d.productsToShow[b]??{})?.[o.id]??[],z=L?.length,{quantity_current_item:k,set_discount_current_item:U}=v?.advances??{},W=(U??u.APPLY_DISCOUNT_OPTION.any)===u.APPLY_DISCOUNT_OPTION.any,$=R===u.UPSELL_METHOD.manual?L.map(X=>{let Q=_.convertProductShopifyData(l?.[X.id])??X,Z=new Set(X.variants.map(K=>K.id)),tt=Q.variants.filter(K=>K.available&&Z.has(K.id));return tt.length?{...Q,quantity:X?.quantity??1,variants:tt}:!1}).filter(Boolean):L,P=$.slice(0,F),p=$.slice(F,z);_.empty(p)||(d.productsHidden[b]={...d.productsHidden[b]??{}},d.productsHidden[b][M.id]=p);let A=0,C=P.reduce((X,Q)=>{let Z=l?.[Q.id],tt=Q.variants[0],K=Z?Z.variants.find(dt=>dt.id===tt.id)?.price/ct:tt.price,rt=k??Q?.quantity??1,lt=Q.id===M.id,at=W?Number(rt):0;return!at&&lt&&(A=Number(rt)*K),X+Number(K)*(lt?at:Number(Q?.quantity??1))},0),w=v.products.discount,J=v.products.shipping_discount,V=C+A,r=()=>{let X=w.value;switch(w.type){case u.DISCOUNT_TYPE.percentage:return A+C*(100-X)/100;case u.DISCOUNT_TYPE.fixed_amount:return V-Math.min(X,C);default:let Q=P.filter(Z=>Z.id!==M.id||W).sort((Z,tt)=>{let K=l?.[tt.id],rt=tt.variants[0],lt=K?K.variants.find(bt=>bt.id===rt.id)?.price/ct:rt.price,at=l?.[Z.id],dt=Z.variants[0],vt=at?at.variants.find(bt=>bt.id===dt.id)?.price/ct:dt.price;return Number(vt)-Number(lt)});return V-Number(Q?.[0].variants?.[0]?.price??0)}},D=(S??!0)&&w.type===u.DISCOUNT_TYPE.percentage,{body_image_classic:B,body_info_classic:g,body_stack:N,is_show_discount_amount:x,products_count:H}=d.renderSection(P,v,M),Y=x&&w.status,j=H*73>400?"overflow-y: scroll;":"",ot=FGSECOMAPP.helper.templateHTML.render(s,{bogos_fbt_price_title:`${G.convertIntegration(h??"Total price","customize.fbt_price_title","customize.fbt.total_price_text")}: `,bogos_fbt_footer_discounted_price:_.renderPrice(Y?r():V),bogos_fbt_footer_original_price:Y?_.renderPrice(V):"",bogos_fbt_footer_add_button:G.convertIntegration(y??"Add selected items","customize.fbt_button_text","customize.fbt.button_text")+` ${Y&&D?`(${w.value+`% ${G.convertIntegration("OFF","customize.fbt_text_off","customize.fbt.off_text")}`})`:""}`}),st=FGSECOMAPP.helper.templateHTML.render(c,{bogos_fbt_header_title:G.convertIntegration(v.name,`fbt.${b}.name`,`fbt.${b}.name`),bogos_fbt_header_description:G.convertIntegration(v.description,`fbt.${b}.description`,`fbt.${b}.description`)}),nt=FGSECOMAPP.helper.templateHTML.render(`<div class="bogos-fbt-shipping-wrapper">${i}</div>`,{bogos_shipping_discount_title:G.convertIntegration(J?.label??"",`fbt.${v.id}.shipping_label`,`fbt.${v.id}.shipping_label`),bogos_shipping_icon:I??fgShippingIconsObj["shipping-icon-1.png"]}),gt=J&&w.status,yt=FGSECOMAPP.helper.templateHTML.render(m,{bogos_fbt_upsell_body_item:T?B:N,bogos_fbt_upsell_footer_classic:T?ot:"",bogos_fbt_upsell_body_classic_info:T?g:"",bogos_fbt_upsell_shipping_discount_classic:T&&gt?nt:"",bogos_fbt_overflow:j}),mt=_.empty(p)?"":FGSECOMAPP.helper.templateHTML.render(a,{bogos_fbt_see_more:G.convertIntegration("See more","customize.fbt_see_more","customize.fbt.see_more")+` (${p.length} 
                    ${G.convertIntegration("product(s)","customize.fbt_product_text","customize.fbt.product_text")})`});return FGSECOMAPP.helper.templateHTML.render(t,{bogos_fbt_upsell_header:st,bogos_fbt_upsell_body:yt,bogos_fbt_upsell_footer_stack:T?"":ot,bogos_upsell_id:b,bogos_fbt_upsell_stack_shipping_discount:gt&&!T?nt:"",bogos_fbt_upsell_stack_see_more:T?"":mt,bogos_fbt_upsell_classic_see_more:T?mt:""})}).join(" ")},refreshState:(e,o)=>{let n=e.getAttribute("data-upsell-id"),t=FGSECOMAPP.current_upsells_fbt.find(P=>P.id===parseInt(n));if(!t)return;let c=FGSECOMAPP.fgAppearance?.fbt_upsell??{},{widget_layout:m,show_discount_amount:s,show_discount_each_item:a}=c?.general??{},{button_text:i}=c?.content??{},l=(t.advances?.set_discount_current_item??u.APPLY_DISCOUNT_OPTION.any)===u.APPLY_DISCOUNT_OPTION.any,f=t.products.discount,E=t.products.shipping_discount,S=(s??!0)&&f.status&&f.type===u.DISCOUNT_TYPE.percentage,q=(d.productsToShow[n]??{})[o]??[],y=FGSECOMAPP.productsByID,h=0,I=0,F=0,M=[],v=(m??u.FBT_WIDGET_TYPE.classic)===u.FBT_WIDGET_TYPE.classic?".bogos-fbt-upsell-body-classic-item-info":".bogos-fbt-upsell-body-stack-item";e.querySelectorAll(v).forEach(P=>{let p=P.getAttribute("data-variant-id"),A=P.getAttribute("data-quantity-variant")??1,C=q.find(g=>g.variants.find(N=>N.id===parseInt(p)));if(!C)return;let w=P.querySelector(".bogos-fbt-upsell-body-item-checkbox"),J=Object.hasOwn(y,C.id),V=J?y[C.id]:C,r=_.convertProductShopifyData(V,J).variants.find(g=>g.id===parseInt(p))?.price??0,D=C.id===o,B=!D||l;if(w?.checked){let g=B?Number(A):0;h+=Number(r)*g,B&&M.push({id:p,price:Number(r)}),D&&!g&&(F=Number(r)*Number(A)),I++}P.setAttribute("data-variant-price",Number(r)+"")});let b=I>=f.minimum_products,T=F+h,R=()=>{let P=f.value;switch(f.type){case u.DISCOUNT_TYPE.percentage:return F+h*(100-P)/100;case u.DISCOUNT_TYPE.fixed_amount:return T-Math.min(P,h);default:let p=M.sort((A,C)=>A.price-C.price);return T-Number(p?.[0]?.price??0)}},L=_.renderPrice(T),z=_.renderPrice(R());if(e.querySelector(".bogos-fbt-footer-discounted-price").innerHTML=f.status&&b?z:L,e.querySelector(".bogos-fbt-footer-original-price").innerHTML=f.status&&b?L:"",e.querySelector(".bogos-fbt-footer-button-add").innerHTML=G.convertIntegration(i??"Add selected items","customize.fbt_button_text","customize.fbt.button_text")+` ${b&&S?`(${f.value+`% ${G.convertIntegration("OFF","customize.fbt_text_off","customize.fbt.off_text")}`})`:""}`,a){let P=M[0]?.id;e.querySelectorAll(v).forEach((p,A)=>{let C=Number(p.getAttribute("data-variant-price")),w=p.querySelector(".bogos-fbt-upsell-product-discounted-price").innerHTML,J=A||l;if(b&&f.status&&J)switch(f.type){case u.DISCOUNT_TYPE.percentage:w=C*(100-f.value)/100;break;case u.DISCOUNT_TYPE.fixed_amount:w=C;break;case u.DISCOUNT_TYPE.cheapest_free:let r=p.getAttribute("data-variant-id")===P+"",D=p.getAttribute("data-quantity-variant"),B=p.getAttribute("data-variant-price");if(r)if(w=0,Number(D)>1){let N=document.createElement("div");N.innerHTML=d.renderCheapestFreeItems(D,Number(B),!1);let x=N.firstElementChild;p.querySelector(".is-cheapest-free-des-container").innerHTML=x.innerHTML,p.querySelector(".is-cheapest-free-des-container").style.maxHeight="50px",w=C}else p.querySelector(".is-cheapest-free-des-container").style.maxHeight="0px";else w=C,p.querySelector(".is-cheapest-free-des-container").style.maxHeight="0px";let g=N=>N?"add":"remove";p.classList?.[g(r)]("is-cheapest-free"),p.querySelector(".is-cheapest-free-label").classList?.[g(!r)]("sca-d-none");break}else w=C;let V=f.type!==u.DISCOUNT_TYPE.fixed_amount&&w!==C;!V&&!b&&(p.classList.remove("is-cheapest-free"),p.querySelector(".is-cheapest-free-label").classList.add("sca-d-none"),p.querySelector(".is-cheapest-free-des-container").style.maxHeight="0px"),p.querySelector(".bogos-fbt-upsell-product-discounted-price").innerHTML=_.renderPrice(w),p.querySelector(".bogos-fbt-upsell-product-original-price").innerHTML=V?_.renderPrice(C):""})}e.querySelectorAll(".bogos-fbt-upsell-body-classic-item-info")?.forEach(P=>{let p=P.getAttribute("data-variant-id"),A=e.querySelector(`.bogos-fbt-upsell-body-classic-item-img[data-variant-id='${p}']`),C=P.querySelector(".bogos-fbt-upsell-body-item-checkbox");C&&!C.checked?(A?.classList?.add("sca-d-none"),A?.nextElementSibling?.classList.add("sca-d-none")):(A?.classList?.remove("sca-d-none"),A?.nextElementSibling?.classList.remove("sca-d-none"))});let k=e.querySelectorAll(".bogos-fbt-upsell-body-classic-item-info:has(.bogos-fbt-upsell-body-item-checkbox[checked])");if(k.length){let p=k[k.length-1].getAttribute("data-variant-id"),A=e.querySelector(`.bogos-fbt-upsell-body-classic-item-img[data-variant-id='${p}']`);A?.nextElementSibling&&A?.nextElementSibling?.classList.contains("bogos-fbt-plus")&&A?.nextElementSibling.classList.add("sca-d-none")}I?e.querySelector(".bogos-fbt-footer-button-add").classList.remove("bogos-btn-disable"):e.querySelector(".bogos-fbt-footer-button-add").classList.add("bogos-btn-disable");let U=e.querySelector(".bogos-fbt-upsell-body");U.clientHeight>=550&&U.setAttribute("style","overflow-y: scroll;max-height: 550px;"),E&&(P=>{let p=e.querySelector(".bogos-fbt-shipping-discount-container");p&&p.classList?.[P?"remove":"add"]?.("sca-d-none")})(b)},renderCheapestFreeItems:(e,o,n)=>{let t=O.FBT_CHEAPEST_FREE_DES,c=O.FBT_CHEAPEST_FREE_DES_ITEM,m=[0,1].map(s=>{let a=G.convertIntegration("item","customize.fbt_item_text","customize.fbt.item_text"),i=s?1:e-1;return FGSECOMAPP.helper.templateHTML.render(c,{bogos_cheapest_des_count:s?`1 ${a}`:`${e-1} ${a}(s)`,bogos_cheapest_des_price:s?_.renderPrice(0):_.renderPrice(o*i)})}).join(" ");return FGSECOMAPP.helper.templateHTML.render(t,{bogos_cheapest_items:m,bogos_d_none:n?"":"max-height:50px;"})},renderSection:(e,o,n,t=!1)=>{let c=document.querySelector(O.FBT_BODY_ITEM_STACK_ID)?.innerHTML??O.FBT_BODY_ITEM_STACK_SECTION,m=document.querySelector(O.FBT_BODY_SECTION_SELECT_VARIANT_ID)?.innerHTML??O.FBT_BODY_SECTION_SELECT_VARIANT,s=document.querySelector(O.FBT_BODY_ITEM_CLASSIC_IMG_ID)?.innerHTML??O.FBT_BODY_ITEM_CLASSIC_IMG_SECTION,a=O.FBT_BODY_ITEM_CLASSIC_IMG_ITEM,i=document.querySelector(O.FBT_BODY_ITEM_CLASSIC_INFO_ID)?.innerHTML??O.FBT_BODY_ITEM_CLASSIC_INFO_SECTION,l=O.FBT_BODY_ITEM_CLASSIC_INFO_ITEM,f=O.FBT_PRODUCT_QUANTITY,E=O.FBT_CHEAPEST_FREE_LABEL,S=`<div class="bogos-fbt-plus">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M10.75 5.75C10.75 5.33579 10.4142 5 10 5C9.58579 5 9.25 5.33579 9.25 5.75V9.25H5.75C5.33579 9.25 5 9.58579 5 10C5 10.4142 5.33579 10.75 5.75 10.75H9.25L9.25 14.25C9.25 14.6642 9.58579 15 10 15C10.4142 15 10.75 14.6642 10.75 14.25V10.75H14.25C14.6642 10.75 15 10.4142 15 10C15 9.58579 14.6642 9.25 14.25 9.25H10.75V5.75Z" fill="#4A4A4A"/>
                    </svg>
                </div>`,q=(r,D)=>!_.checkIsDefaultTitle(r[0].title)?r.map(g=>FGSECOMAPP.helper.templateHTML.render(m,{bogos_variant_img:g?.thumbnail??D.thumbnail,bogos_variant_id:g.id,bogos_variant_price:g.price,bogos_original_variant_price:g.price,fg_variant_title:g.title,bogos_product_id:D.id})).join(" "):"",y=FGSECOMAPP.productsByID,h=o.products.discount,I=o.products.method===u.UPSELL_METHOD.manual,F=FGSECOMAPP.fgAppearance.fbt_upsell??{},{show_discount_each_item:M}=F?.general??{},{free_item_text:v}=F?.content??{},{show_quantity_input:b,quantity_current_item:T,set_discount_current_item:R}=o?.advances??{},L=r=>{let D=h.value;switch(h.type){case u.DISCOUNT_TYPE.percentage:return r*(100-D)/100;default:return r}},z=[],k=(R??u.APPLY_DISCOUNT_OPTION.any)===u.APPLY_DISCOUNT_OPTION.any,U=e.map(r=>{let D=_.convertProductShopifyData(y?.[r.id])??r,B=new Set(r.variants.map(H=>H.id)),g=D.variants.filter(H=>H.available&&B.has(H.id));if(!g.length)return!1;let N=q(g,{id:r.id,thumbnail:r.thumbnail}),x=r.id===n?.id;return(k||!x)&&z.push({id:g[0].id,price:g[0].price}),{...D,quantity:r?.quantity??1,variants:g,variants_show:N}}).filter(Boolean),W=z.sort((r,D)=>r.price-D.price)?.[0]?.id,$=h.status&&U.length>=h.minimum_products,P=(r=1)=>FGSECOMAPP.helper.templateHTML.render(f,{bogos_fbt_min_quantity:r,bogos_disable:r===1?"disabled":""}),p=r=>FGSECOMAPP.helper.templateHTML.render(E,{bogos_cheapest_free_label:G.convertIntegration(v??"Free 1 item","customize.fbt_free_item_text","customize.fbt.free_item_text"),bogos_d_none:r?"":"sca-d-none"}),A=U.map((r,D)=>{let B=r?.variants[0],g=B?.price,N=h.type===u.DISCOUNT_TYPE.cheapest_free&&U.length>=h.minimum_products&&B.id===W,x=N?0:L(g),H=r.id===n?.id&&!D&&!t,Y=T??r?.quantity??1,j=(H?Y:r?.quantity)??1,ot=_.renderPrice((!H||k)&&$?x:g),st=$&&h.type!==u.DISCOUNT_TYPE.fixed_amount&&x!==g?_.renderPrice(g):"",nt=N&&H&&j>1;return FGSECOMAPP.helper.templateHTML.render(c,{bogos_variant_id:B.id,bogos_fbt_upsell_img:B?.thumbnail??r.thumbnail,bogos_fbt_upsell_title:o.title,bogos_fbt_product_title:r.title,bogos_fbt_product_item_select_variant:r.variants_show,bogos_variant_price:g,bogos_product_id:r.id,bogos_none:_.empty(r.variants_show)?"sca-d-none":"",bogos_fbt_upsell_pro_link:_.routePath(`/products/${r.handle}`),bogos_fbt_product_original_price:(!H||k)&&M?nt?"":st:"",bogos_fbt_product_discounted_price:M?nt?st:ot:"",bogos_this_item:H?`${G.convertIntegration("This item","customize.fbt_this_item","customize.fbt.this_item")} `:"",bogos_fbt_product_quantity:b??!0?P(j):"",bogos_variant_quantity:j,bogos_default_select_variant_title:B?.title,bogos_fbt_cheapest_free:N?"is-cheapest-free":"",bogos_fixed_quantity:!b&&(H&&Y||I)?`x${j}`:"",bogos_fbt_cheapest_free_label:p(N),bogos_fbt_cheapest_free_description:d.renderCheapestFreeItems(j,g,!(N&&j>1))})}).filter(Boolean).join(" "),C=()=>U.map(r=>FGSECOMAPP.helper.templateHTML.render(a,{bogos_variant_id:r.variants[0].id,bogos_fbt_upsell_title:o.title,bogos_fbt_upsell_img:r?.variants[0]?.thumbnail??r.thumbnail,bogos_product_id:r.id,bogos_fbt_upsell_pro_link:_.routePath(`/products/${r.handle}`)})).filter(Boolean).join(S),w=()=>U.map((r,D)=>{let B=r?.variants[0]??{},g=B?.price,N=h.type===u.DISCOUNT_TYPE.cheapest_free&&U.length>=h.minimum_products&&B.id===W,x=r.id===n?.id&&!D&&!t,H=T??r?.quantity??1,Y=(x?H:r?.quantity)??1,j=N&&Y===1?0:L(g),ot=_.renderPrice((!x||k)&&$?j:g),st=$&&h.type!==u.DISCOUNT_TYPE.fixed_amount&&j!==g?_.renderPrice(g):"";return FGSECOMAPP.helper.templateHTML.render(l,{bogos_this_item:x?`${G.convertIntegration("This item","customize.fbt_this_item","customize.fbt.this_item")}`:"",bogos_variant_id:B.id,bogos_fbt_product_title:r.title,bogos_fbt_product_item_select_variant:r.variants_show,bogos_product_id:r.id,bogos_variant_price:g,bogos_none:_.empty(r.variants_show)?"sca-d-none":"",bogos_fbt_product_original_price:(!x||k)&&M?st:"",bogos_fbt_product_discounted_price:M?ot:"",bogos_fbt_upsell_pro_link:_.routePath(`/products/${r.handle}`),bogos_fbt_product_quantity:b??!0?P(Y):"",bogos_variant_quantity:Y,bogos_default_select_variant_title:B?.title,bogos_fixed_quantity:!b&&(x&&H||I)?`x${Y}`:"",bogos_fbt_cheapest_free:N?"is-cheapest-free":"",bogos_fbt_cheapest_free_label:p(N),bogos_fbt_cheapest_free_description:d.renderCheapestFreeItems(Y,g,!(N&&Y>1))})}).filter(Boolean).join(" "),J=t?S+C():FGSECOMAPP.helper.templateHTML.render(s,{bogos_items:C()}),V=t?w():FGSECOMAPP.helper.templateHTML.render(i,{bogos_items:w()});return{body_stack:A,body_info_classic:V,body_image_classic:J,is_show_discount_amount:$,products_count:U.length}},renderEventQuery:(e,o)=>{let{current_product:n}=FGSECOMAPP.variables.Shopify??{};o??=n??{};let t=FGSECOMAPP.QUERY_SELECTOR?.product_form_query?.fbt_upsell?.filter(Boolean)?.map(s=>`${s} .bogos-fbt-upsell-container`)?.join(",");if(_.empty(t))return;let c=o.id,m=s=>{s.querySelectorAll(".bogos-fbt-product-title").forEach(a=>{a.addEventListener("mouseenter",function(i){let l=a.innerHTML;_.createTooltip(l,i.pageX+5,i.pageY+5)}),a.addEventListener("mouseleave",function(){_.removeTooltip()}),a.addEventListener("mousemove",_.moveTooltip)})};e?.querySelectorAll(t).forEach(s=>{let a=s.getAttribute("data-upsell-id"),{widget_layout:i}=FGSECOMAPP.fgAppearance?.fbt_upsell?.general??{},l=(i??u.FBT_WIDGET_TYPE.classic)===u.FBT_WIDGET_TYPE.classic,f=l?".bogos-fbt-upsell-body-classic-item-info-wrapper":".bogos-fbt-upsell-body",E=s.querySelector(f);if(E){let S=l?"bogos-fbt-upsell-body-classic-item-info":"bogos-fbt-upsell-body-stack-item";E.addEventListener("change",q=>{let y=q.target??document.createElement("div"),{checked:h}=y;if(y.classList.contains("bogos-fbt-upsell-body-item-checkbox")&&(h?y.setAttribute("checked",""):y.removeAttribute("checked"),d.refreshState(s,c)),y.classList.contains("bogos-fbt-upsell-quantity-input")){let I=parseInt(`${y?.value}`);y.value=isNaN(I)||I<1?1:I;let F=y.closest(".bogos-fbt-upsell-product-quantity");if(F){let M=F.querySelector(".bogos-minus-fbt-btn");M.disabled=I<=1}F.setAttribute("data-quantity-variant",I.toString()),d.refreshState(s,c)}}),E.addEventListener("click",q=>{let y=q.target??document.createElement("div"),h=y.closest(`.${S}`);if(h){let I=h.querySelector(".bogos-fbt-upsell-select-variant-dropdown"),F=h.querySelector(".bogos-fbt-upsell-product-variants"),M=L=>{let z=L,k={id:(z??{id:"0"})?.id-0},U=z.getAttribute("data-product-id"),W=s.querySelector(`${l?".bogos-fbt-upsell-body-classic-item-info":".bogos-fbt-upsell-body-stack-item"}[data-product-id="${U}"]`),$=W.getAttribute("data-product-id"),P=W.querySelector(`li[value="${k.id}"]`);W.setAttribute("data-variant-id",k.id+""),s.querySelector(`.bogos-fbt-upsell-body-classic-item-img[data-product-id='${$}']`)?.setAttribute("data-variant-id",k.id+"");let p=l?`.bogos-fbt-upsell-body-classic-item-img[data-product-id='${$}']`:`.bogos-fbt-upsell-body-stack-item[data-variant-id='${k.id}']`,A=s.querySelector(`${p} .bogos-fbt-upsell-img`);A&&(A.src=P.getAttribute("data-img")),F.querySelector(".bogos-fbt-upsell-select-variant-title").textContent=z.textContent,I.classList.remove("opened"),d.refreshState(s,c)};y.classList.contains("bogos-fbt-variant-item")&&M(y),!F.contains(y)&&!I.classList.contains("opened")&&E.querySelectorAll(".bogos-fbt-upsell-select-variant-dropdown").forEach(L=>{L.classList.remove("opened")}),(y.classList.contains("bogos-fbt-upsell-select-variant-dropdown")||y.classList.contains("bogos-fbt-upsell-select-variant-title"))&&I.classList.toggle("opened");let v=h.querySelector(".bogos-fbt-upsell-product-quantity");if(!v)return;let b=v.querySelector(".bogos-minus-fbt-btn"),T=v.querySelector(".bogos-fbt-upsell-quantity-input"),R=()=>{let L=parseInt(T.value);b.disabled=L<=1,h.setAttribute("data-quantity-variant",L.toString()),d.refreshState(s,c)};if(R(),y.classList.contains("bogos-minus-fbt-btn")){let L=parseInt(T.value);T.value=L-1,R()}if(y.classList.contains("bogos-plus-fbt-btn")){let L=parseInt(T.value);T.value=L+1,R()}}})}m(s),s.querySelector(".bogos-fbt-see-more")?.addEventListener("click",()=>{let S=(d.productsHidden[a]??{})?.[c]??[],q=FGSECOMAPP.current_upsells_fbt.find(F=>F.id===parseInt(a)),{body_info_classic:y,body_image_classic:h,body_stack:I}=d.renderSection(S,q,o,!0);l?(s.querySelector(".bogos-fbt-upsell-body-classic-item-info-wrapper").insertAdjacentHTML("beforeend",y),s.querySelector(".bogos-fbt-upsell-body-classic-item-img-wrapper").insertAdjacentHTML("beforeend",h)):s.querySelector(".bogos-fbt-upsell-extra").insertAdjacentHTML("beforeend",I),s.querySelector(".bogos-fbt-see-more").classList.add("sca-d-none"),m(s),d.productsHidden[a]={...d.productsHidden[a]??{}},d.productsHidden[a][c]=[],d.refreshState(s,c)}),s.querySelector(".bogos-fbt-footer-button-add").addEventListener("click",async function(){this.disabled=!0,this.classList.add("bogos-upsells-adding");let S=this.innerHTML;this.innerHTML="";let{widget_layout:q}=FGSECOMAPP.fgAppearance?.fbt_upsell?.general??{},y=(q??u.FBT_WIDGET_TYPE.classic)===u.FBT_WIDGET_TYPE.classic?".bogos-fbt-upsell-body-classic-item-info":".bogos-fbt-upsell-body-stack-item",h=[];s.querySelectorAll(y).forEach(v=>{let b=v.querySelector(".bogos-fbt-upsell-body-item-checkbox");b&&b.checked&&h.push({id:parseInt(v.getAttribute("data-variant-id")),quantity:parseInt(v.getAttribute("data-quantity-variant"))})});let I=!0;_.empty(s.querySelector(".bogos-fbt-footer-original-price").innerHTML)&&(I=!1);let{ok:F,message:M}=await it.add(h,c,a,u.UPSELL_TYPE.fbt,I);if(F)this.disabled=!1;else{let v=document.createElement("div");v.classList.add("bogos-upsell-error"),v.innerHTML=M,this.parentElement?.insertBefore(v,this)}this.innerHTML=S,this.classList.remove("bogos-upsells-adding")})})},render:async e=>{let o=!FGSECOMAPP.current_upsells_fbt?.length,{product_form_query:n}=FGSECOMAPP.QUERY_SELECTOR??{},t=document.querySelectorAll(n?.fbt_upsell?.join(",")),c=[];o||console.info("BOGOS track: upsell fbt core",e);for(let a of t){let i=d.filterWithBlocks(a),l=FGSECOMAPP.variables.Shopify.block_products?.[i[0]?.current_product]??FGSECOMAPP.productsByID?.[i[0]?.current_product],f=await d.convertData(i,l),E=!f?.length,S=a.querySelector("#bogos-fbt-upsell-preview-mode");if(S&&E){it.renderEmpty(S);continue}else if(E)continue;a.innerHTML=d.renderUpsells(f,l),d.renderEventQuery(a,l),c.push(...f)}if(o)return;if(!t.length){let a=await d.convertData(),i=d.renderUpsells(a),l=[...n?.integration,...n?.default].filter(Boolean).join(",");t=document.querySelector(l);let f=document.createElement("div");f.id="bogos-fbt-upsell-view",f.innerHTML=i,t?.appendChild(f),c.push(...FGSECOMAPP.current_upsells_fbt),d.renderEventQuery(t)}let{fbt:m,default:s}=u.UPSELL_TYPE;_.empty(t)||(c=Object.values(Object.assign({},...c.map(a=>({[a.id]:a})))),ft.sessionViews(c,m,s).then()),document.dispatchEvent(new CustomEvent(FGSECOMAPP.CUSTOM_EVENTS.BOGOS_FBT_RENDER,{detail:{upsells:t,addFunction:(a,i,l)=>it.add(a,l,i,u.UPSELL_TYPE.fbt)}}))},init:async(e,o)=>{try{await d.filter(o),await d.render(e)}catch(n){console.warn("BOGOS track: upsell fbt init failed",n)}}},_={...ht,convertProductShopifyData:(e,o=!0)=>{if(_.empty(e))return null;let{fg_decimal:n}=FGSECOMAPP.variables.Shopify;return{id:e.id,title:e.title,handle:e.handle,available:e.available,productType:e.type,thumbnail:e.featured_image,tags:e.tags,vendor:e.vendor,variants:e.variants.map(t=>({id:t.id,available:t.available,title:t.title,thumbnail:t?.featured_image?.src,price:Number(o?t.price/ct:t.price).toFixed(n??2)})).filter(t=>t.available)}}},ut={..._t,queryProductsRecommended:async(e,o=8)=>{let n=await _t.query({query:Tt.GET_PRODUCTS_RECOMMENDED,variables:{id:e.productId,intent:e.intent,numberCollections:250,numberVariants:250}});if(!n?.ok)return{};let{data:t}=await n.json(),{productRecommendations:c}=t,m=c??[];return _t.defaultReturnProducts(m).data.slice(0,o)}},et={processing:!1,createGlobalVariables:()=>{window.BOGOS_CORE?.helper&&(BOGOS_CORE.helper.upsell={}),document.addEventListener(FGSECOMAPP.CUSTOM_EVENTS.BOGOS_UPSELL_INIT,()=>{_.debounce(async()=>{et.processing||(et.processing=!0,await it.init(FGSECOMAPP.CUSTOM_EVENTS.BOGOS_UPSELL_INIT).then(),et.processing=!1)},250)()})},cssLink:()=>{let e=document.querySelector("#bogos-upsell-style"),o=e?.getAttribute("data-url"),n=e?.parentNode??document.body;if(!o||document.querySelector(`[href*="${o}"]`))return;let t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.media="all",t.href=o,n.insertBefore(t,n.firstChild)},init:async()=>{et.createGlobalVariables(),et.cssLink(),await it.init("init")}};et.init().then()})();})();
