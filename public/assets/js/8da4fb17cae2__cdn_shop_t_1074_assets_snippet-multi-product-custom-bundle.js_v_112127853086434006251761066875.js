"use strict";(self.webpackChunkshopify_theme=self.webpackChunkshopify_theme||[]).push([[415],{"0f221f946571b8e6a701":(__unused_webpack_module,__unused_webpack___webpack_exports__,__webpack_require__)=>{var react=__webpack_require__("9811ef06b956fcd727d6"),clsx_m=__webpack_require__("0bec4b8beb117f5ab05d"),cart=__webpack_require__("ab83936d5e4547a34b1f");const style_module_scss_CustomBundle__anchorHidden="mod_multi_product_custom_bundle_eDL0qq_CustomBundle__anchorHidden",style_module_scss_CustomBundle__highlight="mod_multi_product_custom_bundle_eDL0qq_CustomBundle__highlight",style_module_scss_CustomBundle__optionsBackdrop_active="mod_multi_product_custom_bundle_eDL0qq_CustomBundle__optionsBackdrop_active",style_module_scss_CustomBundle__selectSingle="mod_multi_product_custom_bundle_eDL0qq_CustomBundle__selectSingle",Options=({showOptions,handleSelectedVariant,setOpenOption,productVariants,selectedVariant,productIndex,optionIndex})=>react.createElement("div",{className:(0,clsx_m.default)("mod_multi_product_custom_bundle_eDL0qq_CustomBundle__options",{"Product-swatches-popup__active":showOptions},"Product-swatches-popup"),"data-swatches-type":"product_options"},react.createElement("button",{type:"button","aria-label":"Close Swatches Popup",onClick:()=>setOpenOption(null),className:"Product-swatches-popup-header u-hideMd__flex"},react.createElement("span",null),react.createElement("span",null)),react.createElement("ul",{className:"mod_multi_product_custom_bundle_eDL0qq_CustomBundle__optionsList"},productVariants.map(variant=>{const variantId=variant.variant_id.toString(),status=variant.available?"available":variant.waitlist?"waitlist":"oos";return react.createElement("li",{key:variantId,className:(0,clsx_m.default)("Product-swatches-popup-container"),"aria-label":"Select "+variant.title,tabIndex:0,"data-selected":selectedVariant===variantId,"data-available":status!=="oos",onClick:()=>handleSelectedVariant(variantId,productIndex,optionIndex,status),onKeyDown:e=>{e.key==="Enter"&&handleSelectedVariant(variantId,productIndex,optionIndex,status)},role:"button"},variant.image?react.createElement("img",{src:variant.image,alt:variant.title,className:"Product-swatches-popup-image"}):variant.color?react.createElement("div",{className:"Product-swatches-popup-color",style:{backgroundColor:variant.color}}):null,react.createElement("div",{className:"Product-swatches-popup-container-info"},react.createElement("b",null,variant.title,variant.description!==""||status!=="available"?" - ":null),status!=="available"&&variant.oos_message?react.createElement("span",null,variant.oos_message):react.createElement("span",null,variant.description)),variant.is_new&&react.createElement("span",{className:"Product-swatches-swatch__badge"},"new"))})));var freeze_body_scrolling=__webpack_require__("355a436d015b881d6188"),use_media_query=__webpack_require__("c06e62dd8262b23f449e"),uid=__webpack_require__("69f8ff54509624d84153"),traversal=__webpack_require__("b56a16cdaeb8dc9b98d0"),cart_drawer_open_request=__webpack_require__("2bd8f051f728f879832e"),main=__webpack_require__("556e9bae4a656349c5e1");const DropdownArrow=()=>react.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"6",viewBox:"0 0 10 6",fill:"none"},react.createElement("path",{d:"M4.29296 5.29249L0.707479 1.70766C0.0774266 1.07772 0.523574 0.000488281 1.41452 0.000488281H8.58548C9.47643 0.000488281 9.92257 1.07772 9.29252 1.70766L5.70704 5.29249C5.31653 5.68293 4.68347 5.68293 4.29296 5.29249Z",fill:"#67645E"}));var format_money=__webpack_require__("71c1c01bc06c47144711");const App=({bundleData})=>{const machine=(0,cart.getCartMachine)(),mainBus=(0,main.initMainBus)(),[selectedVariants,setSelectedVariants]=(0,react.useState)(()=>bundleData.products.map(product=>product.variants.length>1||!product.variants[0]?[]:[product.variants[0].variant_id.toString()])),[bundleStatus,setBundleStatus]=(0,react.useState)("available"),[highlightUnselected,setHighlightUnselected]=(0,react.useState)(!1),[openOptions,setOpenOptions]=(0,react.useState)(null),atcButtonRef=(0,react.useRef)([]),bisButtonRef=(0,react.useRef)(null),isDesktop=(0,use_media_query.default)("(min-width: 821px)"),{number_of_products:numberOfProducts,discounts,products}=bundleData,isSelectDropdownOpen=(0,react.useCallback)(option=>JSON.stringify(openOptions)===JSON.stringify(option),[openOptions]),getSelectedVariant=(0,react.useCallback)(variantId=>variantId?products.flatMap(product=>product.variants).find(variant=>variant.variant_id.toString()===variantId):null,[products]),handleSelectedVariant=(0,react.useCallback)((variantId,productIndex,optionIndex)=>{setOpenOptions(null);const updatedVariants=[...selectedVariants];updatedVariants[productIndex]||(updatedVariants[productIndex]=[]),updatedVariants[productIndex][optionIndex]=variantId,setSelectedVariants(updatedVariants)},[selectedVariants]);(0,react.useEffect)(()=>{bisButtonRef.current=document.querySelector(".js-custom-bundle-bis")},[]);const addProductsToCart=(0,react.useCallback)(async selectedVariantsArray=>{const bundleUid=(0,uid.genUid)(),itemsToAdd=selectedVariantsArray.map(variantId=>{const variant=getSelectedVariant(variantId),variantFeaturedImage=variant?.featured_variant_image||"",bundleFeaturedImage=variant?.featured_bundle_image||"",variantProductName=variant?.title||"";return{id:Number(variantId),quantity:1,properties:{_custom_bundle_image:bundleData.bundle_product_image,_custom_bundle_title:bundleData.bundle_product_name,_custom_bundle_variant_uid:(0,uid.genUid)(),_custom_bundle_uid:bundleUid,_custom_bundle_size:bundleData.number_of_products,_custom_bundle_discount:discounts.discount,_custom_bundle_discount_uk:discounts.discount_gb,_custom_bundle_discount_eu:discounts.discount_eu,_custom_bundle_discount_ca:discounts.discount_ca,_custom_bundle_discount_dk:discounts.discount_dk,_custom_bundle_discount_se:discounts.discount_se,_custom_bundle_discount_pl:discounts.discount_pl,_custom_bundle_discount_message:bundleData.discount_message,_custom_bundle_url:bundleData.bundle_url,_custom_bundle_limit_qty:bundleData.bundle_limit_qty.toString(),_custom_bundle_qty:1,_bundle_item_name:variantProductName,_featured_variant_image:variantFeaturedImage,_featured_bundle_image:bundleFeaturedImage}}});return new Promise(function(resolve,reject){machine.addItems({resolve,reject,input:{items:itemsToAdd}})})},[machine,bundleData,discounts,getSelectedVariant]),handleAtc=(0,react.useCallback)(async()=>{const selectedVariantsFlatArray=selectedVariants.flat(),numberOfSelectedVariants=selectedVariantsFlatArray.length;var _bisButtonRef_current;if(bundleStatus!=="oos")if(numberOfSelectedVariants<numberOfProducts)setHighlightUnselected(!0);else if(bundleStatus!=="waitlist")try{await addProductsToCart(selectedVariantsFlatArray),(0,cart_drawer_open_request.sendCartDrawerOpenRequestEvent)()}catch(error){const errorElement=document.querySelector(".js-custom-bundle-error");if(!errorElement)return;let errorMessage="An unknown error occurred";error instanceof Error?errorMessage=error.message:typeof error=="string"&&(errorMessage=error),errorElement.classList.remove("u-hide"),errorElement.textContent=`${errorMessage.replace("Error: ","")}`,setTimeout(()=>{errorElement.classList.add("u-hide"),errorElement.textContent=""},1e4)}else(_bisButtonRef_current=bisButtonRef.current)===null||_bisButtonRef_current===void 0||_bisButtonRef_current.click()},[addProductsToCart,bundleStatus,numberOfProducts,selectedVariants]),finalBundlePrice=(0,react.useMemo)(()=>{const selectedVariantsFlatArray=selectedVariants.flat();if(selectedVariantsFlatArray.length!==numberOfProducts)return null;const variantsFlatArray=products.flatMap(product=>product.variants),priceValue=selectedVariantsFlatArray.reduce((acc,variantId)=>{const variantData=variantsFlatArray.find(variant=>variant.variant_id.toString()===variantId);return acc+(variantData?.price||0)},0),currentMarket=bundleData.current_market,discountKey=currentMarket==="us"?"discount":`discount_${currentMarket}`;let currentDiscount=0;currentDiscount=discountKey in discounts?100*Number(discounts[discountKey])*numberOfProducts:100*Number(discounts.discount_eu)*numberOfProducts;const discountValue=priceValue-currentDiscount;return(0,format_money.formatMoney)(discountValue,bundleData.money_format)},[selectedVariants,numberOfProducts,bundleData.current_market,discounts,products,bundleData.money_format]);return(0,react.useEffect)(()=>{finalBundlePrice&&atcButtonRef.current.forEach(button=>{button.querySelectorAll(".js-price").forEach(priceElement=>{priceElement.textContent=bundleData.current_market==="ca"?finalBundlePrice.replace("$","CA$"):finalBundlePrice})})},[finalBundlePrice,bundleData.current_market]),(0,react.useEffect)(()=>{Object.keys(selectedVariants).length===numberOfProducts&&atcButtonRef.current.forEach(button=>{button.removeAttribute("href")}),(()=>{const selectedVariantsFlatArray=selectedVariants.flat(),variantsFlatArray=products.flatMap(product=>product.variants),selectedVariantsStatus=Object.values(selectedVariantsFlatArray).map(variantId=>{const variantData=variantsFlatArray.find(variant=>variant.variant_id.toString()===variantId);return variantData?.available?"available":variantData?.waitlist?"waitlist":"oos"});if(selectedVariantsStatus.length===0)return;const isOos=selectedVariantsStatus.includes("oos"),isWaitlist=selectedVariantsStatus.includes("waitlist");if(!isOos&&!isWaitlist&&selectedVariantsStatus.length!==numberOfProducts)return;const newBundleStatus=isOos?"oos":isWaitlist?"waitlist":"available";setBundleStatus(newBundleStatus),document.querySelectorAll(".js-atc-button[data-status]").forEach(button=>{button.classList.toggle("u-hide",button.getAttribute("data-status")!==newBundleStatus)})})()},[numberOfProducts,products,selectedVariants]),(0,react.useEffect)(()=>{atcButtonRef.current&&atcButtonRef.current.length!==0||(atcButtonRef.current=(0,traversal.findElements)(document,".js-custom-bundle-atc"));const currentButtons=atcButtonRef.current;if(currentButtons.length>0)return currentButtons.forEach(button=>{button.addEventListener("click",handleAtc)}),()=>{currentButtons.forEach(button=>{button.removeEventListener("click",handleAtc)})}},[handleAtc]),(0,react.useEffect)(()=>{const isMenuOpen=openOptions!==null,body=document.querySelector("body"),productTabs=document.querySelector(".js-product-tabs");isMenuOpen?(body?.setAttribute("data-has-swatches-popup-opened","true"),productTabs instanceof HTMLElement&&(productTabs.style.zIndex="0")):(body?.setAttribute("data-has-swatches-popup-opened","false"),setTimeout(()=>{productTabs instanceof HTMLElement&&(productTabs.style.zIndex="1")},300)),isDesktop||(isMenuOpen?(0,freeze_body_scrolling.freeze)():(0,freeze_body_scrolling.thaw)())},[openOptions,isDesktop]),react.createElement("div",{className:(0,clsx_m.default)("mod_multi_product_custom_bundle_eDL0qq_CustomBundle")},products.map((item,productIndex)=>{const showSingleVariant=item.variants.length===1&&!item.is_smp;return react.createElement(react.Fragment,null,react.createElement("div",{key:"custom-bundle-item"+productIndex,className:"mod_multi_product_custom_bundle_eDL0qq_CustomBundle__header"},react.createElement("h3",{className:(0,clsx_m.default)("mod_multi_product_custom_bundle_eDL0qq_CustomBundle__title","u-pSize","u-bold")},item.product_title),!showSingleVariant&&react.createElement("p",{className:"mod_multi_product_custom_bundle_eDL0qq_CustomBundle__subtitle"},bundleData.bundle_choose_quantity_title," ",item.product_qty)),react.createElement("div",{className:(0,clsx_m.default)("mod_multi_product_custom_bundle_eDL0qq_CustomBundle__content",{flex:item.product_qty===1})},react.createElement("div",{className:"mod_multi_product_custom_bundle_eDL0qq_CustomBundle__wrapper"},Array.from({length:item.product_qty}).map((_,optionIndex)=>{var _selectedVariants_productIndex,_selectedVariants_productIndex1,_selectedVariants_optionIndex;const currentSelectIndex=item.product_qty>1?`${optionIndex+1}`:"",option={productIndex,optionIndex},selectedVariantId=(_selectedVariants_productIndex=selectedVariants[productIndex])===null||_selectedVariants_productIndex===void 0?void 0:_selectedVariants_productIndex[optionIndex],selectedVariant=getSelectedVariant(selectedVariantId);return react.createElement("div",{key:`${item.product_title}-selector-${optionIndex}`,className:"mod_multi_product_custom_bundle_eDL0qq_CustomBundle__product"},react.createElement("button",{type:"button","aria-label":`Select shade ${currentSelectIndex}`,onClick:()=>(option2=>{isSelectDropdownOpen(option2)?setOpenOptions(null):setOpenOptions(option2)})(option),className:(0,clsx_m.default)("mod_multi_product_custom_bundle_eDL0qq_CustomBundle__select",{[style_module_scss_CustomBundle__selectSingle]:showSingleVariant})},selectedVariant?react.createElement("div",{className:"mod_multi_product_custom_bundle_eDL0qq_CustomBundle__selectedValue"},selectedVariant.image?react.createElement("div",{className:"Product-swatches-popup-image-wrapper"},react.createElement("img",{src:selectedVariant.image,tabIndex:-1,className:"Product-swatches-popup-image-selected"})):selectedVariant.color?react.createElement("div",{className:"Product-swatches-popup-color",style:{backgroundColor:selectedVariant.color}}):null,react.createElement("b",null,selectedVariant.title),selectedVariant.available||selectedVariant.waitlist?selectedVariant.description?react.createElement("span",null,react.createElement("b",null,"\xA0-\xA0"),`${selectedVariant.description}`):"":react.createElement("span",null,react.createElement("b",null,"\xA0-\xA0"),`${selectedVariant.oos_message}`),!showSingleVariant&&react.createElement(DropdownArrow,null)):react.createElement("div",{className:(0,clsx_m.default)("mod_multi_product_custom_bundle_eDL0qq_CustomBundle__selectedValue",{[style_module_scss_CustomBundle__highlight]:!(!((_selectedVariants_productIndex1=selectedVariants[productIndex])===null||_selectedVariants_productIndex1===void 0)&&_selectedVariants_productIndex1[optionIndex])&&highlightUnselected},"js-custom-bundle-unselected")},react.createElement("b",null,bundleData.unselected_label," ",currentSelectIndex),!showSingleVariant&&react.createElement(DropdownArrow,null))),!showSingleVariant&&react.createElement(react.Fragment,null,react.createElement(Options,{handleSelectedVariant,showOptions:isSelectDropdownOpen(option),setOpenOption:setOpenOptions,productVariants:item.variants,selectedVariant:(_selectedVariants_optionIndex=selectedVariants[optionIndex])===null||_selectedVariants_optionIndex===void 0?void 0:_selectedVariants_optionIndex[productIndex],productIndex,optionIndex}),react.createElement("div",{className:(0,clsx_m.default)("mod_multi_product_custom_bundle_eDL0qq_CustomBundle__optionsBackdrop",{[style_module_scss_CustomBundle__optionsBackdrop_active]:isSelectDropdownOpen(option)}),onClick:()=>setOpenOptions(null)})))})),bundleData.show_meet_the_shades&&react.createElement("a",{"aria-label":`Open the ${item.product_title} shade drawer`,tabIndex:showSingleVariant?-1:0,className:(0,clsx_m.default)("mod_multi_product_custom_bundle_eDL0qq_CustomBundle__anchor","mod_multi_product_custom_bundle_eDL0qq_CustomBundle__anchorMulti",{[style_module_scss_CustomBundle__anchorHidden]:showSingleVariant}),onClick:()=>{const productVariantIds=item.variants.map(variant=>variant.variant_id.toString());mainBus.send({name:"request:open-shades-drawer",details:{productVariantIds},source:{type:"global"}})}},bundleData.bundle_meet_the_shades_title)))}))};var events=__webpack_require__("104cd0cd3a89b0e4c249"),init_snippet=__webpack_require__("902890af3e9d44054e88"),dist=__webpack_require__("96294add2d9632ee5da8");const VariantsDataIO=(0,dist.type)({variant_id:(0,dist.number)(),featured_bundle_image:(0,dist.nullable)((0,dist.string)()),featured_variant_image:(0,dist.nullable)((0,dist.string)()),image:(0,dist.nullable)((0,dist.string)()),color:(0,dist.nullable)((0,dist.string)()),title:(0,dist.string)(),description:(0,dist.string)(),oos_message:(0,dist.string)(),available:(0,dist.boolean)(),waitlist:(0,dist.boolean)(),is_new:(0,dist.optional)((0,dist.boolean)()),price:(0,dist.number)()}),BundleProductIO=(0,dist.type)({product_id:(0,dist.number)(),product_title:(0,dist.string)(),product_qty:(0,dist.number)(),is_smp:(0,dist.boolean)(),variants:(0,dist.array)(VariantsDataIO)}),DiscountIO=(0,dist.type)({discount:(0,dist.nullable)((0,dist.string)()),discount_gb:(0,dist.nullable)((0,dist.string)()),discount_eu:(0,dist.nullable)((0,dist.string)()),discount_ca:(0,dist.nullable)((0,dist.string)()),discount_dk:(0,dist.nullable)((0,dist.string)()),discount_se:(0,dist.nullable)((0,dist.string)()),discount_pl:(0,dist.nullable)((0,dist.string)())}),BundleProductsIO=(0,dist.type)({unselected_label:(0,dist.string)(),current_market:(0,dist.string)(),discounts:DiscountIO,money_format:(0,dist.string)(),show_meet_the_shades:(0,dist.boolean)(),discount_message:(0,dist.nullable)((0,dist.string)()),bundle_url:(0,dist.string)(),number_of_products:(0,dist.number)(),bundle_product_name:(0,dist.string)(),bundle_product_image:(0,dist.string)(),bundle_limit_qty:(0,dist.number)(),bundle_meet_the_shades_title:(0,dist.nullable)((0,dist.string)()),bundle_more_details_title:(0,dist.nullable)((0,dist.string)()),bundle_choose_quantity_title:(0,dist.nullable)((0,dist.string)()),products:(0,dist.array)(BundleProductIO)});var client=__webpack_require__("3d479b4036d2a7cbfefc");(0,init_snippet.initSnippet)("multi-product-custom-bundle",snippet=>{var _findOneElement;const namespace=(0,events.makeEventNamespace)(),renderTarget=document.querySelector("#js-custom-bundle-render-target"),bundleDataRaw=((_findOneElement=(0,traversal.findOneElement)(snippet,"#js-custom-bundle-data"))===null||_findOneElement===void 0?void 0:_findOneElement.textContent)||"",bundleData=BundleProductsIO.create(JSON.parse(bundleDataRaw));if(namespace.addDelegatedEventListener(snippet,".js-offcanvas-trigger","click",()=>{var _window_dataLayer;(_window_dataLayer=window.dataLayer)===null||_window_dataLayer===void 0||_window_dataLayer.push({event:"shade_finder_interaction"})}),renderTarget==null)throw new Error("Product render target not found");if(bundleDataRaw==null||bundleData==null)throw new Error("Error while parsing bundle data");return(0,client.createRoot)(renderTarget).render(react.createElement(App,{bundleData})),()=>{namespace.destroy()}})}},__webpack_require__=>{__webpack_require__.O(0,[351,502,511,642,902,548,275],()=>__webpack_require__(__webpack_require__.s="0f221f946571b8e6a701")),__webpack_require__.O()}]);
//# sourceMappingURL=/cdn/shop/t/1074/assets/snippet-multi-product-custom-bundle.js.map?v=112127853086434006251761066875
